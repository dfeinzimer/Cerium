<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <script src="https://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script>
    <!-- <script src="../build/roslib.js"></script> -->
    <script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script>

    <!-- <script src="/bootstrap/js"></script> -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script>
      // Connecting to ROS
      // -----------------
      var ros = new ROSLIB.Ros();

      // If there is an error on the backend, an 'error' emit will be emitted.
      ros.on('error', function(error) {
        document.getElementById('connecting').style.display = 'none';
        document.getElementById('connected').style.display = 'none';
        document.getElementById('closed').style.display = 'none';
        document.getElementById('error').style.display = 'inline';
        console.log(error);
      });

      // Find out exactly when we made a connection.
      ros.on('connection', function() {
        console.log('Connection made!');
        document.getElementById('connecting').style.display = 'none';
        document.getElementById('error').style.display = 'none';
        document.getElementById('closed').style.display = 'none';
        document.getElementById('connected').style.display = 'inline';
      });

      ros.on('close', function() {
        console.log('Connection closed.');
        document.getElementById('connecting').style.display = 'none';
        document.getElementById('connected').style.display = 'none';
        document.getElementById('closed').style.display = 'inline';
      });

      // Create a connection to the rosbridge WebSocket server.
      //ros.connect('ws://localhost:9090');
      ros.connect('ws://192.168.1.203:9090');

      // Publishing a Topic
      // ------------------

      // First, we create a Topic object with details of the topic's name and message type.
      var cmdVel = new ROSLIB.Topic({
        ros : ros,
        name : '/cmd_vel',
        messageType : 'geometry_msgs/Twist'
      });

      // Then we create the payload to be published. The object we pass in to ros.Message matches the
      // fields defined in the geometry_msgs/Twist.msg definition.
      var twist = new ROSLIB.Message({
        linear : {
          x : 0.1,
          y : 0.2,
          z : 0.3
        },
        angular : {
          x : -0.1,
          y : -0.2,
          z : -0.3
        }
      });

      var set = new ROSLIB.Message({
        arm : {
          j1 : 0,
          j2 : 0,
          j3 : 0,
          j4 : 0,
          j5_1 : 0,
          j5_2 : 0,
        },
        motors : {
          x : 0,
          y : 0
        },
        mode : 0
      });

      //while(1):
        //console.log(set);
      console.log(set);

      // And finally, publish.
      cmdVel.publish(twist);
      cmdVel.publish(set);

      //Subscribing to a Topic
      //----------------------

      // Like when publishing a topic, we first create a Topic object with details of the topic's name
      // and message type. Note that we can call publish or subscribe on the same topic object.
      var listener = new ROSLIB.Topic({
        ros : ros,
        name : '/listener',
        messageType : 'std_msgs/String'
      });

      // Then we add a callback to be called every time a message is published on this topic.
      listener.subscribe(function(message) {
        console.log('Received message on ' + listener.name + ': ' + message.data);

        // If desired, we can unsubscribe from the topic as well.
        listener.unsubscribe();
      });

      // Calling a service
      // -----------------

      // First, we create a Service client with details of the service's name and service type.
      var addTwoIntsClient = new ROSLIB.Service({
        ros : ros,
        name : '/add_two_ints',
        serviceType : 'rospy_tutorials/AddTwoInts'
      });

      // Then we create a Service Request. The object we pass in to ROSLIB.ServiceRequest matches the
      // fields defined in the rospy_tutorials AddTwoInts.srv file.
      var request = new ROSLIB.ServiceRequest({
        a : 1,
        b : 2
      });

      // Finally, we call the /add_two_ints service and get back the results in the callback. The result
      // is a ROSLIB.ServiceResponse object.
      addTwoIntsClient.callService(request, function(result) {
        console.log('Result for service call on ' + addTwoIntsClient.name + ': ' + result.sum);
      });

      // Advertising a Service
      // ---------------------

      // The Service object does double duty for both calling and advertising services
      var setBoolServer = new ROSLIB.Service({
        ros : ros,
        name : '/set_bool',
        serviceType : 'std_srvs/SetBool'
      });

      // Use the advertise() method to indicate that we want to provide this service
      setBoolServer.advertise(function(request, response) {
        console.log('Received service request on ' + setBoolServer.name + ': ' + request.data);
        response['success'] = true;
        response['message'] = 'Set successfully';
        return true;
      });

      // Setting a param value
      // ---------------------

      ros.getParams(function(params) {
        console.log(params);
      });

      // First, we create a Param object with the name of the param.
      var maxVelX = new ROSLIB.Param({
        ros : ros,
        name : 'max_vel_y'
      });

      //Then we set the value of the param, which is sent to the ROS Parameter Server.
      maxVelX.set(0.8);
      maxVelX.get(function(value) {
        console.log('MAX VAL: ' + value);
      });

      // Getting a param value
      // ---------------------

      var favoriteColor = new ROSLIB.Param({
        ros : ros,
        name : 'favorite_color'
      });

      favoriteColor.set('red');
      favoriteColor.get(function(value) {
        console.log('My robot\'s favorite color is ' + value);
      });

      $(document).ready(function(){
        $('iframe#roverview1').attr('src', 'http://192.168.1.176:8081/');
      });

    </script>
    <title>Titan Rover Cerium</title>
  </head>
  <body>
    <h1>Titan Rover Cerium</h1>
    <div id="statusIndicator">
      <p id="connecting" style="color:ORANGE">
        Connecting to rosbridge on Rover...
      </p>
      <p id="connected" style="color:GREEN; display:none">
        Connected to Rover
      </p>
      <p id="error" style="color:RED; display:none">
        Error connecting to Rover!
      </p>
      <p id="closed" style="color:RED; display:none">
        Rover has closed the connection.
      </p>
    </div>
    <div class="embed-responsive embed-responsive-16by9">
      <iframe id="roverview1" class="embed-responsive-item" src=""></iframe>
    </div>
    <div class="embed-responsive">
      <label for="customRange1">Throttle</label>
      <input type="range" class="custom-range" id="customRange1">
    </div>


  </body>
</html>
